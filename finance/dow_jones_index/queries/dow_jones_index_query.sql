# start sql code
# output table name: sql_table

select
    `date` as date_1,
    `date` as dow_jones_index_date_original_0,
    `close` as dow_jones_index_close_original_2,
    `days_to_next_dividend` as dow_jones_index_days_to_next_dividend_original_3,
    `high` as dow_jones_index_high_original_4,
    `low` as dow_jones_index_low_original_5,
    `next_weeks_close` as dow_jones_index_next_weeks_close_original_6,
    `next_weeks_open` as dow_jones_index_next_weeks_open_original_7,
    `open` as dow_jones_index_open_original_8,
    `percent_change_next_weeks_price` as dow_jones_index_percent_change_next_weeks_price_original_9,
    `percent_change_price` as dow_jones_index_percent_change_price_original_10,
    `percent_change_volume_over_last_wk` as dow_jones_index_percent_change_volume_over_last_wk_original_11,
    `percent_return_next_dividend` as dow_jones_index_percent_return_next_dividend_original_12,
    `previous_weeks_volume` as dow_jones_index_previous_weeks_volume_original_13,
    `quarter` as dow_jones_index_quarter_original_14,
    `stock` as dow_jones_index_stock_original_15,
    case when !isnull(at(`quarter`, 0)) over dow_jones_index_days_to_next_dividend_date_0s_32d_100 then count_where(`quarter`, `quarter` = at(`quarter`, 0)) over dow_jones_index_days_to_next_dividend_date_0s_32d_100 else null end as dow_jones_index_quarter_window_count_16,
    fz_top1_ratio(`previous_weeks_volume`) over dow_jones_index_days_to_next_dividend_date_0s_32d_100 as dow_jones_index_previous_weeks_volume_window_top1_ratio_17,
    fz_top1_ratio(`days_to_next_dividend`) over dow_jones_index_stock_date_0s_64d_200 as dow_jones_index_days_to_next_dividend_window_top1_ratio_18,
    distinct_count(`days_to_next_dividend`) over dow_jones_index_previous_weeks_volume_date_0s_64d_100 as dow_jones_index_days_to_next_dividend_window_unique_count_19,
    fz_top1_ratio(`days_to_next_dividend`) over dow_jones_index_previous_weeks_volume_date_0s_64d_200 as dow_jones_index_days_to_next_dividend_window_top1_ratio_20,
    case when !isnull(at(`quarter`, 0)) over dow_jones_index_previous_weeks_volume_date_0s_64d_200 then count_where(`quarter`, `quarter` = at(`quarter`, 0)) over dow_jones_index_previous_weeks_volume_date_0s_64d_200 else null end as dow_jones_index_quarter_window_count_21,
    fz_top1_ratio(`days_to_next_dividend`) over dow_jones_index_previous_weeks_volume_date_0_10_ as dow_jones_index_days_to_next_dividend_window_top1_ratio_22,
    distinct_count(`days_to_next_dividend`) over dow_jones_index_previous_weeks_volume_date_0_10_ as dow_jones_index_days_to_next_dividend_window_unique_count_23,
    case when !isnull(at(`days_to_next_dividend`, 0)) over dow_jones_index_previous_weeks_volume_date_0s_32d_100 then count_where(`days_to_next_dividend`, `days_to_next_dividend` = at(`days_to_next_dividend`, 0)) over dow_jones_index_previous_weeks_volume_date_0s_32d_100 else null end as dow_jones_index_days_to_next_dividend_window_count_24,
    max(`percent_change_volume_over_last_wk`) over dow_jones_index_quarter_date_0s_7d_100 as dow_jones_index_percent_change_volume_over_last_wk_window_max_25,
    `percent_change_volume_over_last_wk` as dow_jones_index_percent_change_volume_over_last_wk_divide_26,
    `next_weeks_close` as dow_jones_index_next_weeks_close_divide_26,
    min(`percent_change_volume_over_last_wk`) over dow_jones_index_quarter_date_0_10_ as dow_jones_index_percent_change_volume_over_last_wk_window_min_27,
    avg(`percent_change_next_weeks_price`) over dow_jones_index_days_to_next_dividend_date_0s_7d_100 as dow_jones_index_percent_change_next_weeks_price_window_avg_28,
    max(`percent_change_next_weeks_price`) over dow_jones_index_days_to_next_dividend_date_0s_7d_200 as dow_jones_index_percent_change_next_weeks_price_window_max_29,
    `percent_change_volume_over_last_wk` as dow_jones_index_percent_change_volume_over_last_wk_divide_30,
    `low` as dow_jones_index_low_divide_30,
    max(`percent_change_volume_over_last_wk`) over dow_jones_index_quarter_date_0s_14d_100 as dow_jones_index_percent_change_volume_over_last_wk_window_max_31,
    sum(`percent_change_volume_over_last_wk`) over dow_jones_index_quarter_date_0s_7d_200 as dow_jones_index_percent_change_volume_over_last_wk_window_sum_32,
    case when !isnull(at(`previous_weeks_volume`, 0)) over dow_jones_index_days_to_next_dividend_date_0s_32d_100 then count_where(`previous_weeks_volume`, `previous_weeks_volume` = at(`previous_weeks_volume`, 0)) over dow_jones_index_days_to_next_dividend_date_0s_32d_100 else null end as dow_jones_index_previous_weeks_volume_window_count_33
from
    `dow_jones_index`
    window dow_jones_index_days_to_next_dividend_date_0s_32d_100 as (partition by `days_to_next_dividend` order by `date` rows_range between 32d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_stock_date_0s_64d_200 as (partition by `stock` order by `date` rows_range between 64d open preceding and 0s preceding MAXSIZE 200),
    dow_jones_index_previous_weeks_volume_date_0s_64d_100 as (partition by `previous_weeks_volume` order by `date` rows_range between 64d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_previous_weeks_volume_date_0s_64d_200 as (partition by `previous_weeks_volume` order by `date` rows_range between 64d open preceding and 0s preceding MAXSIZE 200),
    dow_jones_index_previous_weeks_volume_date_0_10_ as (partition by `previous_weeks_volume` order by `date` rows between 10 open preceding and 0 preceding),
    dow_jones_index_previous_weeks_volume_date_0s_32d_100 as (partition by `previous_weeks_volume` order by `date` rows_range between 32d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_quarter_date_0s_7d_100 as (partition by `quarter` order by `date` rows_range between 7d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_quarter_date_0_10_ as (partition by `quarter` order by `date` rows between 10 open preceding and 0 preceding),
    dow_jones_index_days_to_next_dividend_date_0s_7d_100 as (partition by `days_to_next_dividend` order by `date` rows_range between 7d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_days_to_next_dividend_date_0s_7d_200 as (partition by `days_to_next_dividend` order by `date` rows_range between 7d open preceding and 0s preceding MAXSIZE 200),
    dow_jones_index_quarter_date_0s_14d_100 as (partition by `quarter` order by `date` rows_range between 14d open preceding and 0s preceding MAXSIZE 100),
    dow_jones_index_quarter_date_0s_7d_200 as (partition by `quarter` order by `date` rows_range between 7d open preceding and 0s preceding MAXSIZE 200);